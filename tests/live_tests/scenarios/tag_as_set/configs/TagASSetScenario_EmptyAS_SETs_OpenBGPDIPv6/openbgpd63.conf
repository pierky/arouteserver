# built by ARouteServer
AS 999
router-id 192.0.2.2

fib-update no
log updates

nexthop qualify via default

INTCOMM_PREF_OK_ROA="soo 65535:1"
INTCOMM_ROUTE_OK_WL="soo 65535:2"
INTCOMM_PREF_OK_ARINDB="soo 65535:3"

INTCOMM_ORIGIN_OK="soo 65535:4"
INTCOMM_ORIGIN_KO="soo 65535:5"
INTCOMM_PREFIX_OK="soo 65535:6"
INTCOMM_PREFIX_KO="soo 65535:7"
INTCOMM_IRR_REJECT="soo 65535:8"

INTCOMM_RPKI_UNKNOWN="soo 65535:9"
INTCOMM_RPKI_INVALID="soo 65535:10"
INTCOMM_RPKI_VALID="soo 65535:11"

INTCOMM_NO_EXPORT="soo 65535:65281"
INTCOMM_NO_ADVERTISE="soo 65535:65282"

# ---------------------------------------------------------
# IRRDB

# WHITE_LIST_AS4_1, used by client AS4_1 white list
AS_SET_WHITE_LIST_AS4_1_asns1="{ 41 }"
AS_SET_WHITE_LIST_AS4_1_prefixes1="{ 4.2.0.0/16 prefixlen 16 - 32, 2a04:2::/32 prefixlen 32 - 128 }"

# AS4, used by client AS4_1, client AS4_2
# no origin ASNs found for AS4
# no prefixes found for AS4

# WHITE_LIST_AS2_2, used by client AS2_2 white list
AS_SET_WHITE_LIST_AS2_2_asns1="{ 21 }"
AS_SET_WHITE_LIST_AS2_2_prefixes1="{ 2.2.0.0/16 prefixlen 16 - 32, 2a02:2::/32 prefixlen 32 - 128 }"

# AS-AS5_FROM_PDB, used by client AS5_1, client AS5_2
# no origin ASNs found for AS_AS5_FROM_PDB
# no prefixes found for AS_AS5_FROM_PDB

# AS-AS4, used by client AS4_1, client AS4_2
# no origin ASNs found for AS_AS4
# no prefixes found for AS_AS4

# AS2, used by client AS2_1, client AS2_2
# no origin ASNs found for AS2
# no prefixes found for AS2

# WHITE_LIST_AS5_2, used by client AS5_2 white list
AS_SET_WHITE_LIST_AS5_2_asns1="{ 51 }"
AS_SET_WHITE_LIST_AS5_2_prefixes1="{ 5.2.0.0/16 prefixlen 16 - 32, 2a05:2::/32 prefixlen 32 - 128 }"

# AS5, used by client AS5_1, client AS5_2
# no origin ASNs found for AS5
# no prefixes found for AS5

# AS6, used by client AS6_1, client AS6_2
# no origin ASNs found for AS6
# no prefixes found for AS6

# WHITE_LIST_AS5_1, used by client AS5_1 white list
AS_SET_WHITE_LIST_AS5_1_asns1="{ 51 }"
AS_SET_WHITE_LIST_AS5_1_prefixes1="{ 5.2.0.0/16 prefixlen 16 - 32, 2a05:2::/32 prefixlen 32 - 128 }"

# WHITE_LIST_AS2_1, used by client AS2_1 white list
AS_SET_WHITE_LIST_AS2_1_asns1="{ 21 }"
AS_SET_WHITE_LIST_AS2_1_prefixes1="{ 2.2.0.0/16 prefixlen 16 - 32, 2a02:2::/32 prefixlen 32 - 128 }"

# AS1, used by client AS1_1, client AS1_2
# no origin ASNs found for AS1
# no prefixes found for AS1

# WHITE_LIST_AS4_2, used by client AS4_2 white list
AS_SET_WHITE_LIST_AS4_2_asns1="{ 41 }"
AS_SET_WHITE_LIST_AS4_2_prefixes1="{ 4.2.0.0/16 prefixlen 16 - 32, 2a04:2::/32 prefixlen 32 - 128 }"

# AS-AS2, used by client AS2_1, client AS2_2
# no origin ASNs found for AS_AS2
# no prefixes found for AS_AS2




# ---------------------------------------------------------
# MEMBERS

group "clients" {

	neighbor 192.0.2.11 {
		remote-as 1

		descr "AS1_1 client, no AS-SET"
		passive
		ttl-security no
		transparent-as yes
		enforce neighbor-as no

		announce all
		announce as-4byte yes
		announce IPv6 none
		announce IPv4 unicast

		set nexthop no-modify
	}

	neighbor 2001:db8:1:1::11 {
		remote-as 1

		descr "AS1_1 client, no AS-SET"
		passive
		ttl-security no
		transparent-as yes
		enforce neighbor-as no

		announce all
		announce as-4byte yes
		announce IPv6 unicast
		announce IPv4 none

		set nexthop no-modify
	}

	neighbor 192.0.2.21 {
		remote-as 2

		descr "AS2_1 client, AS-SET from AS..."
		passive
		ttl-security no
		transparent-as yes
		enforce neighbor-as no

		announce all
		announce as-4byte yes
		announce IPv6 none
		announce IPv4 unicast

		set nexthop no-modify
	}

	neighbor 2001:db8:1:1::21 {
		remote-as 2

		descr "AS2_1 client, AS-SET from AS..."
		passive
		ttl-security no
		transparent-as yes
		enforce neighbor-as no

		announce all
		announce as-4byte yes
		announce IPv6 unicast
		announce IPv4 none

		set nexthop no-modify
	}

	neighbor 192.0.2.41 {
		remote-as 4

		descr "AS4_1 client, AS-SET configu..."
		passive
		ttl-security no
		transparent-as yes
		enforce neighbor-as no

		announce all
		announce as-4byte yes
		announce IPv6 none
		announce IPv4 unicast

		set nexthop no-modify
	}

	neighbor 2001:db8:1:1::41 {
		remote-as 4

		descr "AS4_1 client, AS-SET configu..."
		passive
		ttl-security no
		transparent-as yes
		enforce neighbor-as no

		announce all
		announce as-4byte yes
		announce IPv6 unicast
		announce IPv4 none

		set nexthop no-modify
	}

	neighbor 192.0.2.51 {
		remote-as 5

		descr "AS5_1 client, AS-SET from Pe..."
		passive
		ttl-security no
		transparent-as yes
		enforce neighbor-as no

		announce all
		announce as-4byte yes
		announce IPv6 none
		announce IPv4 unicast

		set nexthop no-modify
	}

	neighbor 2001:db8:1:1::51 {
		remote-as 5

		descr "AS5_1 client, AS-SET from Pe..."
		passive
		ttl-security no
		transparent-as yes
		enforce neighbor-as no

		announce all
		announce as-4byte yes
		announce IPv6 unicast
		announce IPv4 none

		set nexthop no-modify
	}

	neighbor 192.0.2.61 {
		remote-as 6

		descr "AS6_1 client"
		passive
		ttl-security no
		transparent-as yes
		enforce neighbor-as no

		announce all
		announce as-4byte yes
		announce IPv6 none
		announce IPv4 unicast

		set nexthop no-modify
	}

	neighbor 2001:db8:1:1::61 {
		remote-as 6

		descr "AS6_1 client"
		passive
		ttl-security no
		transparent-as yes
		enforce neighbor-as no

		announce all
		announce as-4byte yes
		announce IPv6 unicast
		announce IPv4 none

		set nexthop no-modify
	}
}



# ---------------------------------------------------------
# FILTERS

# NO_ADVERTISE usage notes.
# The NO_ADVERTISE well-know community is used here to handle
# filters that span over multiple steps. At first it is added
# to any route, then it is removed as filters conditions are
# satisfied. Finally, if it is still present, it means that
# the route should be discarded.






bogons="{ 0.0.0.0/0, 0.0.0.0/8 prefixlen 8 - 32, 10.0.0.0/8 prefixlen 8 - 32, 127.0.0.0/8 prefixlen 8 - 32, 169.254.0.0/16 prefixlen 16 - 32, 172.16.0.0/12 prefixlen 12 - 32, 192.0.2.0/24 prefixlen 24 - 32, 192.168.0.0/16 prefixlen 16 - 32, 198.18.0.0/15 prefixlen 15 - 32, 198.51.100.0/24 prefixlen 24 - 32, 203.0.113.0/24 prefixlen 24 - 32, 224.0.0.0/3 prefixlen 3 - 32, 100.64.0.0/10 prefixlen 10 - 32, ::/0, ::/8 prefixlen 8 - 128, 64:ff9b::/96 prefixlen 96 - 128, 100::/8 prefixlen 8 - 128, 200::/7 prefixlen 7 - 128, 400::/6 prefixlen 6 - 128, 800::/5 prefixlen 5 - 128, 1000::/4 prefixlen 4 - 128, 2001::/33 prefixlen 33 - 128, 2001:0:8000::/33 prefixlen 33 - 128, 2001:2::/48 prefixlen 48 - 128, 2001:3::/32 prefixlen 32 - 128, 2001:10::/28 prefixlen 28 - 128, 2001:20::/28 prefixlen 28 - 128, 2001:db8::/32 prefixlen 32 - 128, 2002::/16 prefixlen 16 - 128, 3ffe::/16 prefixlen 16 - 128, 4000::/3 prefixlen 3 - 128, 5f00::/8 prefixlen 8 - 128, 6000::/3 prefixlen 3 - 128, 8000::/3 prefixlen 3 - 128, a000::/3 prefixlen 3 - 128, c000::/3 prefixlen 3 - 128, e000::/4 prefixlen 4 - 128, f000::/5 prefixlen 5 - 128, f800::/6 prefixlen 6 - 128, fc00::/7 prefixlen 7 - 128, fe80::/10 prefixlen 10 - 128, fec0::/10 prefixlen 10 - 128, ff00::/8 prefixlen 8 - 128 }"

# Scrub communities from inbound routes
# origin_not_present_in_as_set
match from group clients set community delete 999:64515
match from group clients set large-community delete 999:0:64515

# origin_present_in_as_set
match from group clients set community delete 999:64514
match from group clients set large-community delete 999:0:64514

# prefix_not_present_in_as_set
match from group clients set community delete 999:64513
match from group clients set large-community delete 999:0:64513

# prefix_present_in_as_set
match from group clients set community delete 999:64512
match from group clients set large-community delete 999:0:64512

# prefix_validated_via_arin_whois_db_dump
match from group clients set community delete 999:64518
match from group clients set large-community delete 999:0:64518

# prefix_validated_via_rpki_roas
match from group clients set community delete 999:64516
match from group clients set large-community delete 999:0:64516

# route_validated_via_white_list
match from group clients set community delete 999:64517
match from group clients set large-community delete 999:0:64517


# Scrub internal communities from inbound routes
match from group clients set { ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Internal communities used for RFC1997 well-known communities handling

# Transform NO_EXPORT into $INTCOMM_NO_EXPORT
match from group clients community NO_EXPORT set ext-community $INTCOMM_NO_EXPORT
match from group clients community NO_EXPORT set community delete NO_EXPORT

# Transform NO_ADVERTISE into $INTCOMM_NO_ADVERTISE
match from group clients community NO_ADVERTISE set ext-community $INTCOMM_NO_ADVERTISE
match from group clients community NO_ADVERTISE set community delete NO_ADVERTISE




# Set the 'rejected_route_announced_by' community for all the clients.
# It will be removed later if the route is not invalid
match from 192.0.2.11 set ext-community rt 65520:1

match from 2001:db8:1:1::11 set ext-community rt 65520:1

match from 192.0.2.21 set ext-community rt 65520:2

match from 2001:db8:1:1::21 set ext-community rt 65520:2

match from 192.0.2.41 set ext-community rt 65520:4

match from 2001:db8:1:1::41 set ext-community rt 65520:4

match from 192.0.2.51 set ext-community rt 65520:5

match from 2001:db8:1:1::51 set ext-community rt 65520:5

match from 192.0.2.61 set ext-community rt 65520:6

match from 2001:db8:1:1::61 set ext-community rt 65520:6


# AS_PATH: length
# Reject inbound routes when 'from group clients max-as-len 32' - reject code: 1
match from group clients max-as-len 32 set community 65520:0
match from group clients max-as-len 32 set community 65520:1
match quick from group clients max-as-len 32 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# Prefix: only IPv6 Global Unicast space allowed
match from group clients inet6 set community NO_ADVERTISE
match from group clients prefix 2000::/3 or-longer set community delete NO_ADVERTISE
# Reject inbound routes when 'from group clients community NO_ADVERTISE' - reject code: 10
match from group clients community NO_ADVERTISE set community 65520:0
match from group clients community NO_ADVERTISE set community 65520:10
match quick from group clients community NO_ADVERTISE set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# Prefix: bogon
# Reject inbound routes when 'from group clients prefix $bogons' - reject code: 2
match from group clients prefix $bogons set community 65520:0
match from group clients prefix $bogons set community 65520:2
match quick from group clients prefix $bogons set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# ---------------------------------------------
# client AS1_1, inbound


# Reject inbound routes when 'from 192.0.2.11 inet6' - reject code: 4
match from 192.0.2.11 inet6 set community 65520:0
match from 192.0.2.11 inet6 set community 65520:4
match quick from 192.0.2.11 inet6 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# NEXT_HOP
match from 192.0.2.11 set community NO_ADVERTISE
match from 192.0.2.11 nexthop 192.0.2.11 set community delete NO_ADVERTISE
# Reject inbound routes when 'from 192.0.2.11 community NO_ADVERTISE' - reject code: 5
match from 192.0.2.11 community NO_ADVERTISE set community 65520:0
match from 192.0.2.11 community NO_ADVERTISE set community 65520:5
match quick from 192.0.2.11 community NO_ADVERTISE set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: left-most ASN
# Reject inbound routes when 'from 192.0.2.11 peer-as != 1' - reject code: 6
match from 192.0.2.11 peer-as != 1 set community 65520:0
match from 192.0.2.11 peer-as != 1 set community 65520:6
match quick from 192.0.2.11 peer-as != 1 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: invalid ASNs
# Reject inbound routes when 'from 192.0.2.11 AS 0' - reject code: 7
match from 192.0.2.11 AS 0 set community 65520:0
match from 192.0.2.11 AS 0 set community 65520:7
match quick from 192.0.2.11 AS 0 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.11 AS 23456' - reject code: 7
match from 192.0.2.11 AS 23456 set community 65520:0
match from 192.0.2.11 AS 23456 set community 65520:7
match quick from 192.0.2.11 AS 23456 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.11 AS 64496 - 64511' - reject code: 7
match from 192.0.2.11 AS 64496 - 64511 set community 65520:0
match from 192.0.2.11 AS 64496 - 64511 set community 65520:7
match quick from 192.0.2.11 AS 64496 - 64511 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.11 AS 64512 - 65534' - reject code: 7
match from 192.0.2.11 AS 64512 - 65534 set community 65520:0
match from 192.0.2.11 AS 64512 - 65534 set community 65520:7
match quick from 192.0.2.11 AS 64512 - 65534 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.11 AS 65535' - reject code: 7
match from 192.0.2.11 AS 65535 set community 65520:0
match from 192.0.2.11 AS 65535 set community 65520:7
match quick from 192.0.2.11 AS 65535 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# Reject inbound routes when 'from 192.0.2.11 AS 65536 - 65551' - reject code: 7
match from 192.0.2.11 AS 65536 - 65551 set community 65520:0
match from 192.0.2.11 AS 65536 - 65551 set community 65520:7
match quick from 192.0.2.11 AS 65536 - 65551 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.11 AS 65552 - 131071' - reject code: 7
match from 192.0.2.11 AS 65552 - 131071 set community 65520:0
match from 192.0.2.11 AS 65552 - 131071 set community 65520:7
match quick from 192.0.2.11 AS 65552 - 131071 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.11 AS 4200000000 - 4294967294' - reject code: 7
match from 192.0.2.11 AS 4200000000 - 4294967294 set community 65520:0
match from 192.0.2.11 AS 4200000000 - 4294967294 set community 65520:7
match quick from 192.0.2.11 AS 4200000000 - 4294967294 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.11 AS 4294967295' - reject code: 7
match from 192.0.2.11 AS 4294967295 set community 65520:0
match from 192.0.2.11 AS 4294967295 set community 65520:7
match quick from 192.0.2.11 AS 4294967295 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }




match from 192.0.2.11 set ext-community $INTCOMM_IRR_REJECT

# AS_PATH: check origin via AS-SET
# IRRDB filters for AS1_1, AS1: asns
# add $INTCOMM_ORIGIN_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.11 set ext-community $INTCOMM_ORIGIN_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS1 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.11 ext-community $INTCOMM_ORIGIN_KO set community 999:64515
match from 192.0.2.11 ext-community $INTCOMM_ORIGIN_KO set large-community 999:0:64515
# adding present_in_as_set community to authorized routes
match from 192.0.2.11 ext-community $INTCOMM_ORIGIN_OK set community 999:64514
match from 192.0.2.11 ext-community $INTCOMM_ORIGIN_OK set large-community 999:0:64514


# Prefix: check prefix via AS-SET
# IRRDB filters for AS1_1, AS1: prefixes
# add $INTCOMM_PREFIX_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.11 set ext-community $INTCOMM_PREFIX_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS1 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.11 ext-community $INTCOMM_PREFIX_KO set community 999:64513
match from 192.0.2.11 ext-community $INTCOMM_PREFIX_KO set large-community 999:0:64513
# adding present_in_as_set community to authorized routes
match from 192.0.2.11 ext-community $INTCOMM_PREFIX_OK set community 999:64512
match from 192.0.2.11 ext-community $INTCOMM_PREFIX_OK set large-community 999:0:64512








# Prefix: length
# Reject inbound routes when 'from 192.0.2.11 prefix 0.0.0.0/0 prefixlen 8 >< 24' - reject code: 13
match from 192.0.2.11 prefix 0.0.0.0/0 prefixlen 8 >< 24 set community 65520:0
match from 192.0.2.11 prefix 0.0.0.0/0 prefixlen 8 >< 24 set community 65520:13
match quick from 192.0.2.11 prefix 0.0.0.0/0 prefixlen 8 >< 24 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# Remove internal communities before accepting the route
match from 192.0.2.11 set { ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  }

match from 192.0.2.11 set ext-community delete rt 65520:1



allow quick from 192.0.2.11

# ---------------------------------------------
# client AS1_1, outbound

deny quick to 192.0.2.11 community 65520:0



# Blackhole request?
# No blackhole filtering policy given
deny quick to 192.0.2.11 community BLACKHOLE



# NO_EXPORT and NO_ADVERTISE communities

# BGP control communities
allow to 192.0.2.11





# ---------------------------------------------
# client AS1_2, inbound


# Reject inbound routes when 'from 2001:db8:1:1::11 inet' - reject code: 4
match from 2001:db8:1:1::11 inet set community 65520:0
match from 2001:db8:1:1::11 inet set community 65520:4
match quick from 2001:db8:1:1::11 inet set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# NEXT_HOP
match from 2001:db8:1:1::11 set community NO_ADVERTISE
match from 2001:db8:1:1::11 nexthop 2001:db8:1:1::11 set community delete NO_ADVERTISE
# Reject inbound routes when 'from 2001:db8:1:1::11 community NO_ADVERTISE' - reject code: 5
match from 2001:db8:1:1::11 community NO_ADVERTISE set community 65520:0
match from 2001:db8:1:1::11 community NO_ADVERTISE set community 65520:5
match quick from 2001:db8:1:1::11 community NO_ADVERTISE set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: left-most ASN
# Reject inbound routes when 'from 2001:db8:1:1::11 peer-as != 1' - reject code: 6
match from 2001:db8:1:1::11 peer-as != 1 set community 65520:0
match from 2001:db8:1:1::11 peer-as != 1 set community 65520:6
match quick from 2001:db8:1:1::11 peer-as != 1 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: invalid ASNs
# Reject inbound routes when 'from 2001:db8:1:1::11 AS 0' - reject code: 7
match from 2001:db8:1:1::11 AS 0 set community 65520:0
match from 2001:db8:1:1::11 AS 0 set community 65520:7
match quick from 2001:db8:1:1::11 AS 0 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::11 AS 23456' - reject code: 7
match from 2001:db8:1:1::11 AS 23456 set community 65520:0
match from 2001:db8:1:1::11 AS 23456 set community 65520:7
match quick from 2001:db8:1:1::11 AS 23456 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::11 AS 64496 - 64511' - reject code: 7
match from 2001:db8:1:1::11 AS 64496 - 64511 set community 65520:0
match from 2001:db8:1:1::11 AS 64496 - 64511 set community 65520:7
match quick from 2001:db8:1:1::11 AS 64496 - 64511 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::11 AS 64512 - 65534' - reject code: 7
match from 2001:db8:1:1::11 AS 64512 - 65534 set community 65520:0
match from 2001:db8:1:1::11 AS 64512 - 65534 set community 65520:7
match quick from 2001:db8:1:1::11 AS 64512 - 65534 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::11 AS 65535' - reject code: 7
match from 2001:db8:1:1::11 AS 65535 set community 65520:0
match from 2001:db8:1:1::11 AS 65535 set community 65520:7
match quick from 2001:db8:1:1::11 AS 65535 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# Reject inbound routes when 'from 2001:db8:1:1::11 AS 65536 - 65551' - reject code: 7
match from 2001:db8:1:1::11 AS 65536 - 65551 set community 65520:0
match from 2001:db8:1:1::11 AS 65536 - 65551 set community 65520:7
match quick from 2001:db8:1:1::11 AS 65536 - 65551 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::11 AS 65552 - 131071' - reject code: 7
match from 2001:db8:1:1::11 AS 65552 - 131071 set community 65520:0
match from 2001:db8:1:1::11 AS 65552 - 131071 set community 65520:7
match quick from 2001:db8:1:1::11 AS 65552 - 131071 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::11 AS 4200000000 - 4294967294' - reject code: 7
match from 2001:db8:1:1::11 AS 4200000000 - 4294967294 set community 65520:0
match from 2001:db8:1:1::11 AS 4200000000 - 4294967294 set community 65520:7
match quick from 2001:db8:1:1::11 AS 4200000000 - 4294967294 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::11 AS 4294967295' - reject code: 7
match from 2001:db8:1:1::11 AS 4294967295 set community 65520:0
match from 2001:db8:1:1::11 AS 4294967295 set community 65520:7
match quick from 2001:db8:1:1::11 AS 4294967295 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }




match from 2001:db8:1:1::11 set ext-community $INTCOMM_IRR_REJECT

# AS_PATH: check origin via AS-SET
# IRRDB filters for AS1_2, AS1: asns
# add $INTCOMM_ORIGIN_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 2001:db8:1:1::11 set ext-community $INTCOMM_ORIGIN_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS1 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 2001:db8:1:1::11 ext-community $INTCOMM_ORIGIN_KO set community 999:64515
match from 2001:db8:1:1::11 ext-community $INTCOMM_ORIGIN_KO set large-community 999:0:64515
# adding present_in_as_set community to authorized routes
match from 2001:db8:1:1::11 ext-community $INTCOMM_ORIGIN_OK set community 999:64514
match from 2001:db8:1:1::11 ext-community $INTCOMM_ORIGIN_OK set large-community 999:0:64514


# Prefix: check prefix via AS-SET
# IRRDB filters for AS1_2, AS1: prefixes
# add $INTCOMM_PREFIX_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 2001:db8:1:1::11 set ext-community $INTCOMM_PREFIX_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS1 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 2001:db8:1:1::11 ext-community $INTCOMM_PREFIX_KO set community 999:64513
match from 2001:db8:1:1::11 ext-community $INTCOMM_PREFIX_KO set large-community 999:0:64513
# adding present_in_as_set community to authorized routes
match from 2001:db8:1:1::11 ext-community $INTCOMM_PREFIX_OK set community 999:64512
match from 2001:db8:1:1::11 ext-community $INTCOMM_PREFIX_OK set large-community 999:0:64512








# Prefix: length
# Reject inbound routes when 'from 2001:db8:1:1::11 prefix ::/0 prefixlen 12 >< 48' - reject code: 13
match from 2001:db8:1:1::11 prefix ::/0 prefixlen 12 >< 48 set community 65520:0
match from 2001:db8:1:1::11 prefix ::/0 prefixlen 12 >< 48 set community 65520:13
match quick from 2001:db8:1:1::11 prefix ::/0 prefixlen 12 >< 48 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# Remove internal communities before accepting the route
match from 2001:db8:1:1::11 set { ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  }

match from 2001:db8:1:1::11 set ext-community delete rt 65520:1



allow quick from 2001:db8:1:1::11

# ---------------------------------------------
# client AS1_2, outbound

deny quick to 2001:db8:1:1::11 community 65520:0



# Blackhole request?
# No blackhole filtering policy given
deny quick to 2001:db8:1:1::11 community BLACKHOLE



# NO_EXPORT and NO_ADVERTISE communities

# BGP control communities
allow to 2001:db8:1:1::11





# ---------------------------------------------
# client AS2_1, inbound


# Reject inbound routes when 'from 192.0.2.21 inet6' - reject code: 4
match from 192.0.2.21 inet6 set community 65520:0
match from 192.0.2.21 inet6 set community 65520:4
match quick from 192.0.2.21 inet6 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# NEXT_HOP
match from 192.0.2.21 set community NO_ADVERTISE
match from 192.0.2.21 nexthop 192.0.2.21 set community delete NO_ADVERTISE
# Reject inbound routes when 'from 192.0.2.21 community NO_ADVERTISE' - reject code: 5
match from 192.0.2.21 community NO_ADVERTISE set community 65520:0
match from 192.0.2.21 community NO_ADVERTISE set community 65520:5
match quick from 192.0.2.21 community NO_ADVERTISE set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: left-most ASN
# Reject inbound routes when 'from 192.0.2.21 peer-as != 2' - reject code: 6
match from 192.0.2.21 peer-as != 2 set community 65520:0
match from 192.0.2.21 peer-as != 2 set community 65520:6
match quick from 192.0.2.21 peer-as != 2 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: invalid ASNs
# Reject inbound routes when 'from 192.0.2.21 AS 0' - reject code: 7
match from 192.0.2.21 AS 0 set community 65520:0
match from 192.0.2.21 AS 0 set community 65520:7
match quick from 192.0.2.21 AS 0 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.21 AS 23456' - reject code: 7
match from 192.0.2.21 AS 23456 set community 65520:0
match from 192.0.2.21 AS 23456 set community 65520:7
match quick from 192.0.2.21 AS 23456 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.21 AS 64496 - 64511' - reject code: 7
match from 192.0.2.21 AS 64496 - 64511 set community 65520:0
match from 192.0.2.21 AS 64496 - 64511 set community 65520:7
match quick from 192.0.2.21 AS 64496 - 64511 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.21 AS 64512 - 65534' - reject code: 7
match from 192.0.2.21 AS 64512 - 65534 set community 65520:0
match from 192.0.2.21 AS 64512 - 65534 set community 65520:7
match quick from 192.0.2.21 AS 64512 - 65534 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.21 AS 65535' - reject code: 7
match from 192.0.2.21 AS 65535 set community 65520:0
match from 192.0.2.21 AS 65535 set community 65520:7
match quick from 192.0.2.21 AS 65535 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# Reject inbound routes when 'from 192.0.2.21 AS 65536 - 65551' - reject code: 7
match from 192.0.2.21 AS 65536 - 65551 set community 65520:0
match from 192.0.2.21 AS 65536 - 65551 set community 65520:7
match quick from 192.0.2.21 AS 65536 - 65551 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.21 AS 65552 - 131071' - reject code: 7
match from 192.0.2.21 AS 65552 - 131071 set community 65520:0
match from 192.0.2.21 AS 65552 - 131071 set community 65520:7
match quick from 192.0.2.21 AS 65552 - 131071 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.21 AS 4200000000 - 4294967294' - reject code: 7
match from 192.0.2.21 AS 4200000000 - 4294967294 set community 65520:0
match from 192.0.2.21 AS 4200000000 - 4294967294 set community 65520:7
match quick from 192.0.2.21 AS 4200000000 - 4294967294 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.21 AS 4294967295' - reject code: 7
match from 192.0.2.21 AS 4294967295 set community 65520:0
match from 192.0.2.21 AS 4294967295 set community 65520:7
match quick from 192.0.2.21 AS 4294967295 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }




match from 192.0.2.21 set ext-community $INTCOMM_IRR_REJECT

# AS_PATH: check origin via AS-SET
# IRRDB filters for AS2_1, AS2: asns
# add $INTCOMM_ORIGIN_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.21 set ext-community $INTCOMM_ORIGIN_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS2 referenced but empty.
match from 192.0.2.21 source-as $AS_SET_WHITE_LIST_AS2_1_asns1 set { ext-community delete $INTCOMM_ORIGIN_KO ext-community $INTCOMM_ORIGIN_OK	} # WHITE_LIST_AS2_1
# AS-SET AS_AS2 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.21 ext-community $INTCOMM_ORIGIN_KO set community 999:64515
match from 192.0.2.21 ext-community $INTCOMM_ORIGIN_KO set large-community 999:0:64515
# adding present_in_as_set community to authorized routes
match from 192.0.2.21 ext-community $INTCOMM_ORIGIN_OK set community 999:64514
match from 192.0.2.21 ext-community $INTCOMM_ORIGIN_OK set large-community 999:0:64514


# Prefix: check prefix via AS-SET
# IRRDB filters for AS2_1, AS2: prefixes
# add $INTCOMM_PREFIX_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.21 set ext-community $INTCOMM_PREFIX_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS2 referenced but empty.
match from 192.0.2.21 prefix $AS_SET_WHITE_LIST_AS2_1_prefixes1 set { ext-community delete $INTCOMM_PREFIX_KO ext-community $INTCOMM_PREFIX_OK	} # WHITE_LIST_AS2_1
# AS-SET AS_AS2 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.21 ext-community $INTCOMM_PREFIX_KO set community 999:64513
match from 192.0.2.21 ext-community $INTCOMM_PREFIX_KO set large-community 999:0:64513
# adding present_in_as_set community to authorized routes
match from 192.0.2.21 ext-community $INTCOMM_PREFIX_OK set community 999:64512
match from 192.0.2.21 ext-community $INTCOMM_PREFIX_OK set large-community 999:0:64512








# Prefix: length
# Reject inbound routes when 'from 192.0.2.21 prefix 0.0.0.0/0 prefixlen 8 >< 24' - reject code: 13
match from 192.0.2.21 prefix 0.0.0.0/0 prefixlen 8 >< 24 set community 65520:0
match from 192.0.2.21 prefix 0.0.0.0/0 prefixlen 8 >< 24 set community 65520:13
match quick from 192.0.2.21 prefix 0.0.0.0/0 prefixlen 8 >< 24 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# Remove internal communities before accepting the route
match from 192.0.2.21 set { ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  }

match from 192.0.2.21 set ext-community delete rt 65520:2



allow quick from 192.0.2.21

# ---------------------------------------------
# client AS2_1, outbound

deny quick to 192.0.2.21 community 65520:0



# Blackhole request?
# No blackhole filtering policy given
deny quick to 192.0.2.21 community BLACKHOLE



# NO_EXPORT and NO_ADVERTISE communities

# BGP control communities
allow to 192.0.2.21





# ---------------------------------------------
# client AS2_2, inbound


# Reject inbound routes when 'from 2001:db8:1:1::21 inet' - reject code: 4
match from 2001:db8:1:1::21 inet set community 65520:0
match from 2001:db8:1:1::21 inet set community 65520:4
match quick from 2001:db8:1:1::21 inet set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# NEXT_HOP
match from 2001:db8:1:1::21 set community NO_ADVERTISE
match from 2001:db8:1:1::21 nexthop 2001:db8:1:1::21 set community delete NO_ADVERTISE
# Reject inbound routes when 'from 2001:db8:1:1::21 community NO_ADVERTISE' - reject code: 5
match from 2001:db8:1:1::21 community NO_ADVERTISE set community 65520:0
match from 2001:db8:1:1::21 community NO_ADVERTISE set community 65520:5
match quick from 2001:db8:1:1::21 community NO_ADVERTISE set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: left-most ASN
# Reject inbound routes when 'from 2001:db8:1:1::21 peer-as != 2' - reject code: 6
match from 2001:db8:1:1::21 peer-as != 2 set community 65520:0
match from 2001:db8:1:1::21 peer-as != 2 set community 65520:6
match quick from 2001:db8:1:1::21 peer-as != 2 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: invalid ASNs
# Reject inbound routes when 'from 2001:db8:1:1::21 AS 0' - reject code: 7
match from 2001:db8:1:1::21 AS 0 set community 65520:0
match from 2001:db8:1:1::21 AS 0 set community 65520:7
match quick from 2001:db8:1:1::21 AS 0 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::21 AS 23456' - reject code: 7
match from 2001:db8:1:1::21 AS 23456 set community 65520:0
match from 2001:db8:1:1::21 AS 23456 set community 65520:7
match quick from 2001:db8:1:1::21 AS 23456 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::21 AS 64496 - 64511' - reject code: 7
match from 2001:db8:1:1::21 AS 64496 - 64511 set community 65520:0
match from 2001:db8:1:1::21 AS 64496 - 64511 set community 65520:7
match quick from 2001:db8:1:1::21 AS 64496 - 64511 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::21 AS 64512 - 65534' - reject code: 7
match from 2001:db8:1:1::21 AS 64512 - 65534 set community 65520:0
match from 2001:db8:1:1::21 AS 64512 - 65534 set community 65520:7
match quick from 2001:db8:1:1::21 AS 64512 - 65534 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::21 AS 65535' - reject code: 7
match from 2001:db8:1:1::21 AS 65535 set community 65520:0
match from 2001:db8:1:1::21 AS 65535 set community 65520:7
match quick from 2001:db8:1:1::21 AS 65535 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# Reject inbound routes when 'from 2001:db8:1:1::21 AS 65536 - 65551' - reject code: 7
match from 2001:db8:1:1::21 AS 65536 - 65551 set community 65520:0
match from 2001:db8:1:1::21 AS 65536 - 65551 set community 65520:7
match quick from 2001:db8:1:1::21 AS 65536 - 65551 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::21 AS 65552 - 131071' - reject code: 7
match from 2001:db8:1:1::21 AS 65552 - 131071 set community 65520:0
match from 2001:db8:1:1::21 AS 65552 - 131071 set community 65520:7
match quick from 2001:db8:1:1::21 AS 65552 - 131071 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::21 AS 4200000000 - 4294967294' - reject code: 7
match from 2001:db8:1:1::21 AS 4200000000 - 4294967294 set community 65520:0
match from 2001:db8:1:1::21 AS 4200000000 - 4294967294 set community 65520:7
match quick from 2001:db8:1:1::21 AS 4200000000 - 4294967294 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::21 AS 4294967295' - reject code: 7
match from 2001:db8:1:1::21 AS 4294967295 set community 65520:0
match from 2001:db8:1:1::21 AS 4294967295 set community 65520:7
match quick from 2001:db8:1:1::21 AS 4294967295 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }




match from 2001:db8:1:1::21 set ext-community $INTCOMM_IRR_REJECT

# AS_PATH: check origin via AS-SET
# IRRDB filters for AS2_2, AS2: asns
# add $INTCOMM_ORIGIN_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 2001:db8:1:1::21 set ext-community $INTCOMM_ORIGIN_KO
# verifying if object is authorized by AS-SETs
match from 2001:db8:1:1::21 source-as $AS_SET_WHITE_LIST_AS2_2_asns1 set { ext-community delete $INTCOMM_ORIGIN_KO ext-community $INTCOMM_ORIGIN_OK	} # WHITE_LIST_AS2_2
# AS-SET AS2 referenced but empty.
# AS-SET AS_AS2 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 2001:db8:1:1::21 ext-community $INTCOMM_ORIGIN_KO set community 999:64515
match from 2001:db8:1:1::21 ext-community $INTCOMM_ORIGIN_KO set large-community 999:0:64515
# adding present_in_as_set community to authorized routes
match from 2001:db8:1:1::21 ext-community $INTCOMM_ORIGIN_OK set community 999:64514
match from 2001:db8:1:1::21 ext-community $INTCOMM_ORIGIN_OK set large-community 999:0:64514


# Prefix: check prefix via AS-SET
# IRRDB filters for AS2_2, AS2: prefixes
# add $INTCOMM_PREFIX_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 2001:db8:1:1::21 set ext-community $INTCOMM_PREFIX_KO
# verifying if object is authorized by AS-SETs
match from 2001:db8:1:1::21 prefix $AS_SET_WHITE_LIST_AS2_2_prefixes1 set { ext-community delete $INTCOMM_PREFIX_KO ext-community $INTCOMM_PREFIX_OK	} # WHITE_LIST_AS2_2
# AS-SET AS2 referenced but empty.
# AS-SET AS_AS2 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 2001:db8:1:1::21 ext-community $INTCOMM_PREFIX_KO set community 999:64513
match from 2001:db8:1:1::21 ext-community $INTCOMM_PREFIX_KO set large-community 999:0:64513
# adding present_in_as_set community to authorized routes
match from 2001:db8:1:1::21 ext-community $INTCOMM_PREFIX_OK set community 999:64512
match from 2001:db8:1:1::21 ext-community $INTCOMM_PREFIX_OK set large-community 999:0:64512








# Prefix: length
# Reject inbound routes when 'from 2001:db8:1:1::21 prefix ::/0 prefixlen 12 >< 48' - reject code: 13
match from 2001:db8:1:1::21 prefix ::/0 prefixlen 12 >< 48 set community 65520:0
match from 2001:db8:1:1::21 prefix ::/0 prefixlen 12 >< 48 set community 65520:13
match quick from 2001:db8:1:1::21 prefix ::/0 prefixlen 12 >< 48 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# Remove internal communities before accepting the route
match from 2001:db8:1:1::21 set { ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  }

match from 2001:db8:1:1::21 set ext-community delete rt 65520:2



allow quick from 2001:db8:1:1::21

# ---------------------------------------------
# client AS2_2, outbound

deny quick to 2001:db8:1:1::21 community 65520:0



# Blackhole request?
# No blackhole filtering policy given
deny quick to 2001:db8:1:1::21 community BLACKHOLE



# NO_EXPORT and NO_ADVERTISE communities

# BGP control communities
allow to 2001:db8:1:1::21





# ---------------------------------------------
# client AS4_1, inbound


# Reject inbound routes when 'from 192.0.2.41 inet6' - reject code: 4
match from 192.0.2.41 inet6 set community 65520:0
match from 192.0.2.41 inet6 set community 65520:4
match quick from 192.0.2.41 inet6 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# NEXT_HOP
match from 192.0.2.41 set community NO_ADVERTISE
match from 192.0.2.41 nexthop 192.0.2.41 set community delete NO_ADVERTISE
# Reject inbound routes when 'from 192.0.2.41 community NO_ADVERTISE' - reject code: 5
match from 192.0.2.41 community NO_ADVERTISE set community 65520:0
match from 192.0.2.41 community NO_ADVERTISE set community 65520:5
match quick from 192.0.2.41 community NO_ADVERTISE set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: left-most ASN
# Reject inbound routes when 'from 192.0.2.41 peer-as != 4' - reject code: 6
match from 192.0.2.41 peer-as != 4 set community 65520:0
match from 192.0.2.41 peer-as != 4 set community 65520:6
match quick from 192.0.2.41 peer-as != 4 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: invalid ASNs
# Reject inbound routes when 'from 192.0.2.41 AS 0' - reject code: 7
match from 192.0.2.41 AS 0 set community 65520:0
match from 192.0.2.41 AS 0 set community 65520:7
match quick from 192.0.2.41 AS 0 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.41 AS 23456' - reject code: 7
match from 192.0.2.41 AS 23456 set community 65520:0
match from 192.0.2.41 AS 23456 set community 65520:7
match quick from 192.0.2.41 AS 23456 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.41 AS 64496 - 64511' - reject code: 7
match from 192.0.2.41 AS 64496 - 64511 set community 65520:0
match from 192.0.2.41 AS 64496 - 64511 set community 65520:7
match quick from 192.0.2.41 AS 64496 - 64511 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.41 AS 64512 - 65534' - reject code: 7
match from 192.0.2.41 AS 64512 - 65534 set community 65520:0
match from 192.0.2.41 AS 64512 - 65534 set community 65520:7
match quick from 192.0.2.41 AS 64512 - 65534 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.41 AS 65535' - reject code: 7
match from 192.0.2.41 AS 65535 set community 65520:0
match from 192.0.2.41 AS 65535 set community 65520:7
match quick from 192.0.2.41 AS 65535 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# Reject inbound routes when 'from 192.0.2.41 AS 65536 - 65551' - reject code: 7
match from 192.0.2.41 AS 65536 - 65551 set community 65520:0
match from 192.0.2.41 AS 65536 - 65551 set community 65520:7
match quick from 192.0.2.41 AS 65536 - 65551 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.41 AS 65552 - 131071' - reject code: 7
match from 192.0.2.41 AS 65552 - 131071 set community 65520:0
match from 192.0.2.41 AS 65552 - 131071 set community 65520:7
match quick from 192.0.2.41 AS 65552 - 131071 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.41 AS 4200000000 - 4294967294' - reject code: 7
match from 192.0.2.41 AS 4200000000 - 4294967294 set community 65520:0
match from 192.0.2.41 AS 4200000000 - 4294967294 set community 65520:7
match quick from 192.0.2.41 AS 4200000000 - 4294967294 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.41 AS 4294967295' - reject code: 7
match from 192.0.2.41 AS 4294967295 set community 65520:0
match from 192.0.2.41 AS 4294967295 set community 65520:7
match quick from 192.0.2.41 AS 4294967295 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# client's white list
# Add the $INTCOMM_ROUTE_OK_WL ext community to routes which
# are validated by a client's white list entry.
# It will be used later during IRRDB validation in
# case the route is not authorized by a client's
# AS-SET.
match from 192.0.2.41 prefix 2a04:4::/32 source-as 44 set ext-community $INTCOMM_ROUTE_OK_WL	# None
match from 192.0.2.41 prefix 2a04:5::/32 prefixlen 32 - 128 source-as 43 set ext-community $INTCOMM_ROUTE_OK_WL	# None
match from 192.0.2.41 prefix 2a04:6::/32 prefixlen 32 - 128 set ext-community $INTCOMM_ROUTE_OK_WL	# None
match from 192.0.2.41 prefix 4.4.0.0/16 source-as 44 set ext-community $INTCOMM_ROUTE_OK_WL	# None
match from 192.0.2.41 prefix 4.5.0.0/16 prefixlen 16 - 32 source-as 43 set ext-community $INTCOMM_ROUTE_OK_WL	# None
match from 192.0.2.41 prefix 4.6.0.0/16 prefixlen 16 - 32 set ext-community $INTCOMM_ROUTE_OK_WL	# None

match from 192.0.2.41 set ext-community $INTCOMM_IRR_REJECT

# AS_PATH: check origin via AS-SET
# IRRDB filters for AS4_1, AS4: asns
# add $INTCOMM_ORIGIN_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.41 set ext-community $INTCOMM_ORIGIN_KO
# verifying if object is authorized by AS-SETs
match from 192.0.2.41 source-as $AS_SET_WHITE_LIST_AS4_1_asns1 set { ext-community delete $INTCOMM_ORIGIN_KO ext-community $INTCOMM_ORIGIN_OK	} # WHITE_LIST_AS4_1
# AS-SET AS4 referenced but empty.
# AS-SET AS_AS4 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.41 ext-community $INTCOMM_ORIGIN_KO set community 999:64515
match from 192.0.2.41 ext-community $INTCOMM_ORIGIN_KO set large-community 999:0:64515
# adding present_in_as_set community to authorized routes
match from 192.0.2.41 ext-community $INTCOMM_ORIGIN_OK set community 999:64514
match from 192.0.2.41 ext-community $INTCOMM_ORIGIN_OK set large-community 999:0:64514


# Prefix: check prefix via AS-SET
# IRRDB filters for AS4_1, AS4: prefixes
# add $INTCOMM_PREFIX_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.41 set ext-community $INTCOMM_PREFIX_KO
# verifying if object is authorized by AS-SETs
match from 192.0.2.41 prefix $AS_SET_WHITE_LIST_AS4_1_prefixes1 set { ext-community delete $INTCOMM_PREFIX_KO ext-community $INTCOMM_PREFIX_OK	} # WHITE_LIST_AS4_1
# AS-SET AS4 referenced but empty.
# AS-SET AS_AS4 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.41 ext-community $INTCOMM_PREFIX_KO set community 999:64513
match from 192.0.2.41 ext-community $INTCOMM_PREFIX_KO set large-community 999:0:64513
# adding present_in_as_set community to authorized routes
match from 192.0.2.41 ext-community $INTCOMM_PREFIX_OK set community 999:64512
match from 192.0.2.41 ext-community $INTCOMM_PREFIX_OK set large-community 999:0:64512




# route authorized by a client's white list?
# NO_ADVERTISE here means $INTCOMM_IRR_REJECT
# (OpenBGPD does not allow matching multiple ext comms at once, so a std comm and an ext comm are used)
match from 192.0.2.41 ext-community $INTCOMM_IRR_REJECT set community NO_ADVERTISE
match from 192.0.2.41 community NO_ADVERTISE ext-community $INTCOMM_ROUTE_OK_WL set community 999:64517
match from 192.0.2.41 community NO_ADVERTISE ext-community $INTCOMM_ROUTE_OK_WL set large-community 999:0:64517

match from 192.0.2.41 community NO_ADVERTISE ext-community $INTCOMM_ROUTE_OK_WL set ext-community delete $INTCOMM_IRR_REJECT
match from 192.0.2.41 set community delete NO_ADVERTISE

# enforcing: origin ASN
# NO_ADVERTISE here means $INTCOMM_IRR_REJECT
# (OpenBGPD does not allow matching multiple ext comms at once, so a std comm and an ext comm are used)
match from 192.0.2.41 ext-community $INTCOMM_IRR_REJECT set community NO_ADVERTISE
# Reject inbound routes when 'from 192.0.2.41 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO' - reject code: 9
match from 192.0.2.41 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO set community 65520:0
match from 192.0.2.41 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO set community 65520:9
match quick from 192.0.2.41 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

match from 192.0.2.41 set community delete NO_ADVERTISE



# Prefix: length
# Reject inbound routes when 'from 192.0.2.41 prefix 0.0.0.0/0 prefixlen 8 >< 24' - reject code: 13
match from 192.0.2.41 prefix 0.0.0.0/0 prefixlen 8 >< 24 set community 65520:0
match from 192.0.2.41 prefix 0.0.0.0/0 prefixlen 8 >< 24 set community 65520:13
match quick from 192.0.2.41 prefix 0.0.0.0/0 prefixlen 8 >< 24 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# Remove internal communities before accepting the route
match from 192.0.2.41 set { ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  }

match from 192.0.2.41 set ext-community delete rt 65520:4



allow quick from 192.0.2.41

# ---------------------------------------------
# client AS4_1, outbound

deny quick to 192.0.2.41 community 65520:0



# Blackhole request?
# No blackhole filtering policy given
deny quick to 192.0.2.41 community BLACKHOLE



# NO_EXPORT and NO_ADVERTISE communities

# BGP control communities
allow to 192.0.2.41





# ---------------------------------------------
# client AS4_2, inbound


# Reject inbound routes when 'from 2001:db8:1:1::41 inet' - reject code: 4
match from 2001:db8:1:1::41 inet set community 65520:0
match from 2001:db8:1:1::41 inet set community 65520:4
match quick from 2001:db8:1:1::41 inet set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# NEXT_HOP
match from 2001:db8:1:1::41 set community NO_ADVERTISE
match from 2001:db8:1:1::41 nexthop 2001:db8:1:1::41 set community delete NO_ADVERTISE
# Reject inbound routes when 'from 2001:db8:1:1::41 community NO_ADVERTISE' - reject code: 5
match from 2001:db8:1:1::41 community NO_ADVERTISE set community 65520:0
match from 2001:db8:1:1::41 community NO_ADVERTISE set community 65520:5
match quick from 2001:db8:1:1::41 community NO_ADVERTISE set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: left-most ASN
# Reject inbound routes when 'from 2001:db8:1:1::41 peer-as != 4' - reject code: 6
match from 2001:db8:1:1::41 peer-as != 4 set community 65520:0
match from 2001:db8:1:1::41 peer-as != 4 set community 65520:6
match quick from 2001:db8:1:1::41 peer-as != 4 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: invalid ASNs
# Reject inbound routes when 'from 2001:db8:1:1::41 AS 0' - reject code: 7
match from 2001:db8:1:1::41 AS 0 set community 65520:0
match from 2001:db8:1:1::41 AS 0 set community 65520:7
match quick from 2001:db8:1:1::41 AS 0 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::41 AS 23456' - reject code: 7
match from 2001:db8:1:1::41 AS 23456 set community 65520:0
match from 2001:db8:1:1::41 AS 23456 set community 65520:7
match quick from 2001:db8:1:1::41 AS 23456 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::41 AS 64496 - 64511' - reject code: 7
match from 2001:db8:1:1::41 AS 64496 - 64511 set community 65520:0
match from 2001:db8:1:1::41 AS 64496 - 64511 set community 65520:7
match quick from 2001:db8:1:1::41 AS 64496 - 64511 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::41 AS 64512 - 65534' - reject code: 7
match from 2001:db8:1:1::41 AS 64512 - 65534 set community 65520:0
match from 2001:db8:1:1::41 AS 64512 - 65534 set community 65520:7
match quick from 2001:db8:1:1::41 AS 64512 - 65534 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::41 AS 65535' - reject code: 7
match from 2001:db8:1:1::41 AS 65535 set community 65520:0
match from 2001:db8:1:1::41 AS 65535 set community 65520:7
match quick from 2001:db8:1:1::41 AS 65535 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# Reject inbound routes when 'from 2001:db8:1:1::41 AS 65536 - 65551' - reject code: 7
match from 2001:db8:1:1::41 AS 65536 - 65551 set community 65520:0
match from 2001:db8:1:1::41 AS 65536 - 65551 set community 65520:7
match quick from 2001:db8:1:1::41 AS 65536 - 65551 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::41 AS 65552 - 131071' - reject code: 7
match from 2001:db8:1:1::41 AS 65552 - 131071 set community 65520:0
match from 2001:db8:1:1::41 AS 65552 - 131071 set community 65520:7
match quick from 2001:db8:1:1::41 AS 65552 - 131071 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::41 AS 4200000000 - 4294967294' - reject code: 7
match from 2001:db8:1:1::41 AS 4200000000 - 4294967294 set community 65520:0
match from 2001:db8:1:1::41 AS 4200000000 - 4294967294 set community 65520:7
match quick from 2001:db8:1:1::41 AS 4200000000 - 4294967294 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::41 AS 4294967295' - reject code: 7
match from 2001:db8:1:1::41 AS 4294967295 set community 65520:0
match from 2001:db8:1:1::41 AS 4294967295 set community 65520:7
match quick from 2001:db8:1:1::41 AS 4294967295 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# client's white list
# Add the $INTCOMM_ROUTE_OK_WL ext community to routes which
# are validated by a client's white list entry.
# It will be used later during IRRDB validation in
# case the route is not authorized by a client's
# AS-SET.
match from 2001:db8:1:1::41 prefix 2a04:4::/32 source-as 44 set ext-community $INTCOMM_ROUTE_OK_WL	# None
match from 2001:db8:1:1::41 prefix 2a04:5::/32 prefixlen 32 - 128 source-as 43 set ext-community $INTCOMM_ROUTE_OK_WL	# None
match from 2001:db8:1:1::41 prefix 2a04:6::/32 prefixlen 32 - 128 set ext-community $INTCOMM_ROUTE_OK_WL	# None
match from 2001:db8:1:1::41 prefix 4.4.0.0/16 source-as 44 set ext-community $INTCOMM_ROUTE_OK_WL	# None
match from 2001:db8:1:1::41 prefix 4.5.0.0/16 prefixlen 16 - 32 source-as 43 set ext-community $INTCOMM_ROUTE_OK_WL	# None
match from 2001:db8:1:1::41 prefix 4.6.0.0/16 prefixlen 16 - 32 set ext-community $INTCOMM_ROUTE_OK_WL	# None

match from 2001:db8:1:1::41 set ext-community $INTCOMM_IRR_REJECT

# AS_PATH: check origin via AS-SET
# IRRDB filters for AS4_2, AS4: asns
# add $INTCOMM_ORIGIN_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 2001:db8:1:1::41 set ext-community $INTCOMM_ORIGIN_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS4 referenced but empty.
# AS-SET AS_AS4 referenced but empty.
match from 2001:db8:1:1::41 source-as $AS_SET_WHITE_LIST_AS4_2_asns1 set { ext-community delete $INTCOMM_ORIGIN_KO ext-community $INTCOMM_ORIGIN_OK	} # WHITE_LIST_AS4_2
# adding not_present_in_as_set community to unauthorized routes
match from 2001:db8:1:1::41 ext-community $INTCOMM_ORIGIN_KO set community 999:64515
match from 2001:db8:1:1::41 ext-community $INTCOMM_ORIGIN_KO set large-community 999:0:64515
# adding present_in_as_set community to authorized routes
match from 2001:db8:1:1::41 ext-community $INTCOMM_ORIGIN_OK set community 999:64514
match from 2001:db8:1:1::41 ext-community $INTCOMM_ORIGIN_OK set large-community 999:0:64514


# Prefix: check prefix via AS-SET
# IRRDB filters for AS4_2, AS4: prefixes
# add $INTCOMM_PREFIX_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 2001:db8:1:1::41 set ext-community $INTCOMM_PREFIX_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS4 referenced but empty.
# AS-SET AS_AS4 referenced but empty.
match from 2001:db8:1:1::41 prefix $AS_SET_WHITE_LIST_AS4_2_prefixes1 set { ext-community delete $INTCOMM_PREFIX_KO ext-community $INTCOMM_PREFIX_OK	} # WHITE_LIST_AS4_2
# adding not_present_in_as_set community to unauthorized routes
match from 2001:db8:1:1::41 ext-community $INTCOMM_PREFIX_KO set community 999:64513
match from 2001:db8:1:1::41 ext-community $INTCOMM_PREFIX_KO set large-community 999:0:64513
# adding present_in_as_set community to authorized routes
match from 2001:db8:1:1::41 ext-community $INTCOMM_PREFIX_OK set community 999:64512
match from 2001:db8:1:1::41 ext-community $INTCOMM_PREFIX_OK set large-community 999:0:64512




# route authorized by a client's white list?
# NO_ADVERTISE here means $INTCOMM_IRR_REJECT
# (OpenBGPD does not allow matching multiple ext comms at once, so a std comm and an ext comm are used)
match from 2001:db8:1:1::41 ext-community $INTCOMM_IRR_REJECT set community NO_ADVERTISE
match from 2001:db8:1:1::41 community NO_ADVERTISE ext-community $INTCOMM_ROUTE_OK_WL set community 999:64517
match from 2001:db8:1:1::41 community NO_ADVERTISE ext-community $INTCOMM_ROUTE_OK_WL set large-community 999:0:64517

match from 2001:db8:1:1::41 community NO_ADVERTISE ext-community $INTCOMM_ROUTE_OK_WL set ext-community delete $INTCOMM_IRR_REJECT
match from 2001:db8:1:1::41 set community delete NO_ADVERTISE

# enforcing: origin ASN
# NO_ADVERTISE here means $INTCOMM_IRR_REJECT
# (OpenBGPD does not allow matching multiple ext comms at once, so a std comm and an ext comm are used)
match from 2001:db8:1:1::41 ext-community $INTCOMM_IRR_REJECT set community NO_ADVERTISE
# Reject inbound routes when 'from 2001:db8:1:1::41 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO' - reject code: 9
match from 2001:db8:1:1::41 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO set community 65520:0
match from 2001:db8:1:1::41 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO set community 65520:9
match quick from 2001:db8:1:1::41 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

match from 2001:db8:1:1::41 set community delete NO_ADVERTISE



# Prefix: length
# Reject inbound routes when 'from 2001:db8:1:1::41 prefix ::/0 prefixlen 12 >< 48' - reject code: 13
match from 2001:db8:1:1::41 prefix ::/0 prefixlen 12 >< 48 set community 65520:0
match from 2001:db8:1:1::41 prefix ::/0 prefixlen 12 >< 48 set community 65520:13
match quick from 2001:db8:1:1::41 prefix ::/0 prefixlen 12 >< 48 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# Remove internal communities before accepting the route
match from 2001:db8:1:1::41 set { ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  }

match from 2001:db8:1:1::41 set ext-community delete rt 65520:4



allow quick from 2001:db8:1:1::41

# ---------------------------------------------
# client AS4_2, outbound

deny quick to 2001:db8:1:1::41 community 65520:0



# Blackhole request?
# No blackhole filtering policy given
deny quick to 2001:db8:1:1::41 community BLACKHOLE



# NO_EXPORT and NO_ADVERTISE communities

# BGP control communities
allow to 2001:db8:1:1::41





# ---------------------------------------------
# client AS5_1, inbound


# Reject inbound routes when 'from 192.0.2.51 inet6' - reject code: 4
match from 192.0.2.51 inet6 set community 65520:0
match from 192.0.2.51 inet6 set community 65520:4
match quick from 192.0.2.51 inet6 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# NEXT_HOP
match from 192.0.2.51 set community NO_ADVERTISE
match from 192.0.2.51 nexthop 192.0.2.51 set community delete NO_ADVERTISE
# Reject inbound routes when 'from 192.0.2.51 community NO_ADVERTISE' - reject code: 5
match from 192.0.2.51 community NO_ADVERTISE set community 65520:0
match from 192.0.2.51 community NO_ADVERTISE set community 65520:5
match quick from 192.0.2.51 community NO_ADVERTISE set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: left-most ASN
# Reject inbound routes when 'from 192.0.2.51 peer-as != 5' - reject code: 6
match from 192.0.2.51 peer-as != 5 set community 65520:0
match from 192.0.2.51 peer-as != 5 set community 65520:6
match quick from 192.0.2.51 peer-as != 5 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: invalid ASNs
# Reject inbound routes when 'from 192.0.2.51 AS 0' - reject code: 7
match from 192.0.2.51 AS 0 set community 65520:0
match from 192.0.2.51 AS 0 set community 65520:7
match quick from 192.0.2.51 AS 0 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.51 AS 23456' - reject code: 7
match from 192.0.2.51 AS 23456 set community 65520:0
match from 192.0.2.51 AS 23456 set community 65520:7
match quick from 192.0.2.51 AS 23456 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.51 AS 64496 - 64511' - reject code: 7
match from 192.0.2.51 AS 64496 - 64511 set community 65520:0
match from 192.0.2.51 AS 64496 - 64511 set community 65520:7
match quick from 192.0.2.51 AS 64496 - 64511 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.51 AS 64512 - 65534' - reject code: 7
match from 192.0.2.51 AS 64512 - 65534 set community 65520:0
match from 192.0.2.51 AS 64512 - 65534 set community 65520:7
match quick from 192.0.2.51 AS 64512 - 65534 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.51 AS 65535' - reject code: 7
match from 192.0.2.51 AS 65535 set community 65520:0
match from 192.0.2.51 AS 65535 set community 65520:7
match quick from 192.0.2.51 AS 65535 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# Reject inbound routes when 'from 192.0.2.51 AS 65536 - 65551' - reject code: 7
match from 192.0.2.51 AS 65536 - 65551 set community 65520:0
match from 192.0.2.51 AS 65536 - 65551 set community 65520:7
match quick from 192.0.2.51 AS 65536 - 65551 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.51 AS 65552 - 131071' - reject code: 7
match from 192.0.2.51 AS 65552 - 131071 set community 65520:0
match from 192.0.2.51 AS 65552 - 131071 set community 65520:7
match quick from 192.0.2.51 AS 65552 - 131071 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.51 AS 4200000000 - 4294967294' - reject code: 7
match from 192.0.2.51 AS 4200000000 - 4294967294 set community 65520:0
match from 192.0.2.51 AS 4200000000 - 4294967294 set community 65520:7
match quick from 192.0.2.51 AS 4200000000 - 4294967294 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.51 AS 4294967295' - reject code: 7
match from 192.0.2.51 AS 4294967295 set community 65520:0
match from 192.0.2.51 AS 4294967295 set community 65520:7
match quick from 192.0.2.51 AS 4294967295 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }




match from 192.0.2.51 set ext-community $INTCOMM_IRR_REJECT

# AS_PATH: check origin via AS-SET
# IRRDB filters for AS5_1, AS5: asns
# add $INTCOMM_ORIGIN_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.51 set ext-community $INTCOMM_ORIGIN_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS_AS5_FROM_PDB referenced but empty.
# AS-SET AS5 referenced but empty.
match from 192.0.2.51 source-as $AS_SET_WHITE_LIST_AS5_1_asns1 set { ext-community delete $INTCOMM_ORIGIN_KO ext-community $INTCOMM_ORIGIN_OK	} # WHITE_LIST_AS5_1
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.51 ext-community $INTCOMM_ORIGIN_KO set community 999:64515
match from 192.0.2.51 ext-community $INTCOMM_ORIGIN_KO set large-community 999:0:64515
# adding present_in_as_set community to authorized routes
match from 192.0.2.51 ext-community $INTCOMM_ORIGIN_OK set community 999:64514
match from 192.0.2.51 ext-community $INTCOMM_ORIGIN_OK set large-community 999:0:64514


# Prefix: check prefix via AS-SET
# IRRDB filters for AS5_1, AS5: prefixes
# add $INTCOMM_PREFIX_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.51 set ext-community $INTCOMM_PREFIX_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS_AS5_FROM_PDB referenced but empty.
# AS-SET AS5 referenced but empty.
match from 192.0.2.51 prefix $AS_SET_WHITE_LIST_AS5_1_prefixes1 set { ext-community delete $INTCOMM_PREFIX_KO ext-community $INTCOMM_PREFIX_OK	} # WHITE_LIST_AS5_1
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.51 ext-community $INTCOMM_PREFIX_KO set community 999:64513
match from 192.0.2.51 ext-community $INTCOMM_PREFIX_KO set large-community 999:0:64513
# adding present_in_as_set community to authorized routes
match from 192.0.2.51 ext-community $INTCOMM_PREFIX_OK set community 999:64512
match from 192.0.2.51 ext-community $INTCOMM_PREFIX_OK set large-community 999:0:64512





# enforcing: prefix
# NO_ADVERTISE here means $INTCOMM_IRR_REJECT
# (OpenBGPD does not allow matching multiple ext comms at once, so a std comm and an ext comm are used)
match from 192.0.2.51 ext-community $INTCOMM_IRR_REJECT set community NO_ADVERTISE
# Reject inbound routes when 'from 192.0.2.51 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO' - reject code: 12
match from 192.0.2.51 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO set community 65520:0
match from 192.0.2.51 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO set community 65520:12
match quick from 192.0.2.51 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

match from 192.0.2.51 set community delete NO_ADVERTISE



# Prefix: length
# Reject inbound routes when 'from 192.0.2.51 prefix 0.0.0.0/0 prefixlen 8 >< 24' - reject code: 13
match from 192.0.2.51 prefix 0.0.0.0/0 prefixlen 8 >< 24 set community 65520:0
match from 192.0.2.51 prefix 0.0.0.0/0 prefixlen 8 >< 24 set community 65520:13
match quick from 192.0.2.51 prefix 0.0.0.0/0 prefixlen 8 >< 24 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# Remove internal communities before accepting the route
match from 192.0.2.51 set { ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  }

match from 192.0.2.51 set ext-community delete rt 65520:5



allow quick from 192.0.2.51

# ---------------------------------------------
# client AS5_1, outbound

deny quick to 192.0.2.51 community 65520:0



# Blackhole request?
# No blackhole filtering policy given
deny quick to 192.0.2.51 community BLACKHOLE



# NO_EXPORT and NO_ADVERTISE communities

# BGP control communities
allow to 192.0.2.51





# ---------------------------------------------
# client AS5_2, inbound


# Reject inbound routes when 'from 2001:db8:1:1::51 inet' - reject code: 4
match from 2001:db8:1:1::51 inet set community 65520:0
match from 2001:db8:1:1::51 inet set community 65520:4
match quick from 2001:db8:1:1::51 inet set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# NEXT_HOP
match from 2001:db8:1:1::51 set community NO_ADVERTISE
match from 2001:db8:1:1::51 nexthop 2001:db8:1:1::51 set community delete NO_ADVERTISE
# Reject inbound routes when 'from 2001:db8:1:1::51 community NO_ADVERTISE' - reject code: 5
match from 2001:db8:1:1::51 community NO_ADVERTISE set community 65520:0
match from 2001:db8:1:1::51 community NO_ADVERTISE set community 65520:5
match quick from 2001:db8:1:1::51 community NO_ADVERTISE set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: left-most ASN
# Reject inbound routes when 'from 2001:db8:1:1::51 peer-as != 5' - reject code: 6
match from 2001:db8:1:1::51 peer-as != 5 set community 65520:0
match from 2001:db8:1:1::51 peer-as != 5 set community 65520:6
match quick from 2001:db8:1:1::51 peer-as != 5 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: invalid ASNs
# Reject inbound routes when 'from 2001:db8:1:1::51 AS 0' - reject code: 7
match from 2001:db8:1:1::51 AS 0 set community 65520:0
match from 2001:db8:1:1::51 AS 0 set community 65520:7
match quick from 2001:db8:1:1::51 AS 0 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::51 AS 23456' - reject code: 7
match from 2001:db8:1:1::51 AS 23456 set community 65520:0
match from 2001:db8:1:1::51 AS 23456 set community 65520:7
match quick from 2001:db8:1:1::51 AS 23456 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::51 AS 64496 - 64511' - reject code: 7
match from 2001:db8:1:1::51 AS 64496 - 64511 set community 65520:0
match from 2001:db8:1:1::51 AS 64496 - 64511 set community 65520:7
match quick from 2001:db8:1:1::51 AS 64496 - 64511 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::51 AS 64512 - 65534' - reject code: 7
match from 2001:db8:1:1::51 AS 64512 - 65534 set community 65520:0
match from 2001:db8:1:1::51 AS 64512 - 65534 set community 65520:7
match quick from 2001:db8:1:1::51 AS 64512 - 65534 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::51 AS 65535' - reject code: 7
match from 2001:db8:1:1::51 AS 65535 set community 65520:0
match from 2001:db8:1:1::51 AS 65535 set community 65520:7
match quick from 2001:db8:1:1::51 AS 65535 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# Reject inbound routes when 'from 2001:db8:1:1::51 AS 65536 - 65551' - reject code: 7
match from 2001:db8:1:1::51 AS 65536 - 65551 set community 65520:0
match from 2001:db8:1:1::51 AS 65536 - 65551 set community 65520:7
match quick from 2001:db8:1:1::51 AS 65536 - 65551 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::51 AS 65552 - 131071' - reject code: 7
match from 2001:db8:1:1::51 AS 65552 - 131071 set community 65520:0
match from 2001:db8:1:1::51 AS 65552 - 131071 set community 65520:7
match quick from 2001:db8:1:1::51 AS 65552 - 131071 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::51 AS 4200000000 - 4294967294' - reject code: 7
match from 2001:db8:1:1::51 AS 4200000000 - 4294967294 set community 65520:0
match from 2001:db8:1:1::51 AS 4200000000 - 4294967294 set community 65520:7
match quick from 2001:db8:1:1::51 AS 4200000000 - 4294967294 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::51 AS 4294967295' - reject code: 7
match from 2001:db8:1:1::51 AS 4294967295 set community 65520:0
match from 2001:db8:1:1::51 AS 4294967295 set community 65520:7
match quick from 2001:db8:1:1::51 AS 4294967295 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }




match from 2001:db8:1:1::51 set ext-community $INTCOMM_IRR_REJECT

# AS_PATH: check origin via AS-SET
# IRRDB filters for AS5_2, AS5: asns
# add $INTCOMM_ORIGIN_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 2001:db8:1:1::51 set ext-community $INTCOMM_ORIGIN_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS_AS5_FROM_PDB referenced but empty.
match from 2001:db8:1:1::51 source-as $AS_SET_WHITE_LIST_AS5_2_asns1 set { ext-community delete $INTCOMM_ORIGIN_KO ext-community $INTCOMM_ORIGIN_OK	} # WHITE_LIST_AS5_2
# AS-SET AS5 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 2001:db8:1:1::51 ext-community $INTCOMM_ORIGIN_KO set community 999:64515
match from 2001:db8:1:1::51 ext-community $INTCOMM_ORIGIN_KO set large-community 999:0:64515
# adding present_in_as_set community to authorized routes
match from 2001:db8:1:1::51 ext-community $INTCOMM_ORIGIN_OK set community 999:64514
match from 2001:db8:1:1::51 ext-community $INTCOMM_ORIGIN_OK set large-community 999:0:64514


# Prefix: check prefix via AS-SET
# IRRDB filters for AS5_2, AS5: prefixes
# add $INTCOMM_PREFIX_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 2001:db8:1:1::51 set ext-community $INTCOMM_PREFIX_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS_AS5_FROM_PDB referenced but empty.
match from 2001:db8:1:1::51 prefix $AS_SET_WHITE_LIST_AS5_2_prefixes1 set { ext-community delete $INTCOMM_PREFIX_KO ext-community $INTCOMM_PREFIX_OK	} # WHITE_LIST_AS5_2
# AS-SET AS5 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 2001:db8:1:1::51 ext-community $INTCOMM_PREFIX_KO set community 999:64513
match from 2001:db8:1:1::51 ext-community $INTCOMM_PREFIX_KO set large-community 999:0:64513
# adding present_in_as_set community to authorized routes
match from 2001:db8:1:1::51 ext-community $INTCOMM_PREFIX_OK set community 999:64512
match from 2001:db8:1:1::51 ext-community $INTCOMM_PREFIX_OK set large-community 999:0:64512





# enforcing: prefix
# NO_ADVERTISE here means $INTCOMM_IRR_REJECT
# (OpenBGPD does not allow matching multiple ext comms at once, so a std comm and an ext comm are used)
match from 2001:db8:1:1::51 ext-community $INTCOMM_IRR_REJECT set community NO_ADVERTISE
# Reject inbound routes when 'from 2001:db8:1:1::51 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO' - reject code: 12
match from 2001:db8:1:1::51 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO set community 65520:0
match from 2001:db8:1:1::51 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO set community 65520:12
match quick from 2001:db8:1:1::51 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

match from 2001:db8:1:1::51 set community delete NO_ADVERTISE



# Prefix: length
# Reject inbound routes when 'from 2001:db8:1:1::51 prefix ::/0 prefixlen 12 >< 48' - reject code: 13
match from 2001:db8:1:1::51 prefix ::/0 prefixlen 12 >< 48 set community 65520:0
match from 2001:db8:1:1::51 prefix ::/0 prefixlen 12 >< 48 set community 65520:13
match quick from 2001:db8:1:1::51 prefix ::/0 prefixlen 12 >< 48 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# Remove internal communities before accepting the route
match from 2001:db8:1:1::51 set { ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  }

match from 2001:db8:1:1::51 set ext-community delete rt 65520:5



allow quick from 2001:db8:1:1::51

# ---------------------------------------------
# client AS5_2, outbound

deny quick to 2001:db8:1:1::51 community 65520:0



# Blackhole request?
# No blackhole filtering policy given
deny quick to 2001:db8:1:1::51 community BLACKHOLE



# NO_EXPORT and NO_ADVERTISE communities

# BGP control communities
allow to 2001:db8:1:1::51





# ---------------------------------------------
# client AS6_1, inbound


# Reject inbound routes when 'from 192.0.2.61 inet6' - reject code: 4
match from 192.0.2.61 inet6 set community 65520:0
match from 192.0.2.61 inet6 set community 65520:4
match quick from 192.0.2.61 inet6 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# NEXT_HOP
match from 192.0.2.61 set community NO_ADVERTISE
match from 192.0.2.61 nexthop 192.0.2.61 set community delete NO_ADVERTISE
# Reject inbound routes when 'from 192.0.2.61 community NO_ADVERTISE' - reject code: 5
match from 192.0.2.61 community NO_ADVERTISE set community 65520:0
match from 192.0.2.61 community NO_ADVERTISE set community 65520:5
match quick from 192.0.2.61 community NO_ADVERTISE set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: left-most ASN
# Reject inbound routes when 'from 192.0.2.61 peer-as != 6' - reject code: 6
match from 192.0.2.61 peer-as != 6 set community 65520:0
match from 192.0.2.61 peer-as != 6 set community 65520:6
match quick from 192.0.2.61 peer-as != 6 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: invalid ASNs
# Reject inbound routes when 'from 192.0.2.61 AS 0' - reject code: 7
match from 192.0.2.61 AS 0 set community 65520:0
match from 192.0.2.61 AS 0 set community 65520:7
match quick from 192.0.2.61 AS 0 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.61 AS 23456' - reject code: 7
match from 192.0.2.61 AS 23456 set community 65520:0
match from 192.0.2.61 AS 23456 set community 65520:7
match quick from 192.0.2.61 AS 23456 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.61 AS 64496 - 64511' - reject code: 7
match from 192.0.2.61 AS 64496 - 64511 set community 65520:0
match from 192.0.2.61 AS 64496 - 64511 set community 65520:7
match quick from 192.0.2.61 AS 64496 - 64511 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.61 AS 64512 - 65534' - reject code: 7
match from 192.0.2.61 AS 64512 - 65534 set community 65520:0
match from 192.0.2.61 AS 64512 - 65534 set community 65520:7
match quick from 192.0.2.61 AS 64512 - 65534 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.61 AS 65535' - reject code: 7
match from 192.0.2.61 AS 65535 set community 65520:0
match from 192.0.2.61 AS 65535 set community 65520:7
match quick from 192.0.2.61 AS 65535 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# Reject inbound routes when 'from 192.0.2.61 AS 65536 - 65551' - reject code: 7
match from 192.0.2.61 AS 65536 - 65551 set community 65520:0
match from 192.0.2.61 AS 65536 - 65551 set community 65520:7
match quick from 192.0.2.61 AS 65536 - 65551 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.61 AS 65552 - 131071' - reject code: 7
match from 192.0.2.61 AS 65552 - 131071 set community 65520:0
match from 192.0.2.61 AS 65552 - 131071 set community 65520:7
match quick from 192.0.2.61 AS 65552 - 131071 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.61 AS 4200000000 - 4294967294' - reject code: 7
match from 192.0.2.61 AS 4200000000 - 4294967294 set community 65520:0
match from 192.0.2.61 AS 4200000000 - 4294967294 set community 65520:7
match quick from 192.0.2.61 AS 4200000000 - 4294967294 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 192.0.2.61 AS 4294967295' - reject code: 7
match from 192.0.2.61 AS 4294967295 set community 65520:0
match from 192.0.2.61 AS 4294967295 set community 65520:7
match quick from 192.0.2.61 AS 4294967295 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# client's white list
# Add the $INTCOMM_ROUTE_OK_WL ext community to routes which
# are validated by a client's white list entry.
# It will be used later during IRRDB validation in
# case the route is not authorized by a client's
# AS-SET.
match from 192.0.2.61 prefix 2a03:2::/32 prefixlen 32 - 128 source-as 3 set ext-community $INTCOMM_ROUTE_OK_WL	# None
match from 192.0.2.61 prefix 3.2.0.0/16 prefixlen 16 - 32 source-as 3 set ext-community $INTCOMM_ROUTE_OK_WL	# None

match from 192.0.2.61 set ext-community $INTCOMM_IRR_REJECT

# AS_PATH: check origin via AS-SET
# IRRDB filters for AS6_1, AS6: asns
# add $INTCOMM_ORIGIN_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.61 set ext-community $INTCOMM_ORIGIN_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS6 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.61 ext-community $INTCOMM_ORIGIN_KO set community 999:64515
match from 192.0.2.61 ext-community $INTCOMM_ORIGIN_KO set large-community 999:0:64515
# adding present_in_as_set community to authorized routes
match from 192.0.2.61 ext-community $INTCOMM_ORIGIN_OK set community 999:64514
match from 192.0.2.61 ext-community $INTCOMM_ORIGIN_OK set large-community 999:0:64514


# Prefix: check prefix via AS-SET
# IRRDB filters for AS6_1, AS6: prefixes
# add $INTCOMM_PREFIX_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 192.0.2.61 set ext-community $INTCOMM_PREFIX_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS6 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 192.0.2.61 ext-community $INTCOMM_PREFIX_KO set community 999:64513
match from 192.0.2.61 ext-community $INTCOMM_PREFIX_KO set large-community 999:0:64513
# adding present_in_as_set community to authorized routes
match from 192.0.2.61 ext-community $INTCOMM_PREFIX_OK set community 999:64512
match from 192.0.2.61 ext-community $INTCOMM_PREFIX_OK set large-community 999:0:64512




# route authorized by a client's white list?
# NO_ADVERTISE here means $INTCOMM_IRR_REJECT
# (OpenBGPD does not allow matching multiple ext comms at once, so a std comm and an ext comm are used)
match from 192.0.2.61 ext-community $INTCOMM_IRR_REJECT set community NO_ADVERTISE
match from 192.0.2.61 community NO_ADVERTISE ext-community $INTCOMM_ROUTE_OK_WL set community 999:64517
match from 192.0.2.61 community NO_ADVERTISE ext-community $INTCOMM_ROUTE_OK_WL set large-community 999:0:64517

match from 192.0.2.61 community NO_ADVERTISE ext-community $INTCOMM_ROUTE_OK_WL set ext-community delete $INTCOMM_IRR_REJECT
match from 192.0.2.61 set community delete NO_ADVERTISE

# enforcing: origin ASN
# NO_ADVERTISE here means $INTCOMM_IRR_REJECT
# (OpenBGPD does not allow matching multiple ext comms at once, so a std comm and an ext comm are used)
match from 192.0.2.61 ext-community $INTCOMM_IRR_REJECT set community NO_ADVERTISE
# Reject inbound routes when 'from 192.0.2.61 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO' - reject code: 9
match from 192.0.2.61 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO set community 65520:0
match from 192.0.2.61 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO set community 65520:9
match quick from 192.0.2.61 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

match from 192.0.2.61 set community delete NO_ADVERTISE
# enforcing: prefix
# NO_ADVERTISE here means $INTCOMM_IRR_REJECT
# (OpenBGPD does not allow matching multiple ext comms at once, so a std comm and an ext comm are used)
match from 192.0.2.61 ext-community $INTCOMM_IRR_REJECT set community NO_ADVERTISE
# Reject inbound routes when 'from 192.0.2.61 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO' - reject code: 12
match from 192.0.2.61 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO set community 65520:0
match from 192.0.2.61 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO set community 65520:12
match quick from 192.0.2.61 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

match from 192.0.2.61 set community delete NO_ADVERTISE



# Prefix: length
# Reject inbound routes when 'from 192.0.2.61 prefix 0.0.0.0/0 prefixlen 8 >< 24' - reject code: 13
match from 192.0.2.61 prefix 0.0.0.0/0 prefixlen 8 >< 24 set community 65520:0
match from 192.0.2.61 prefix 0.0.0.0/0 prefixlen 8 >< 24 set community 65520:13
match quick from 192.0.2.61 prefix 0.0.0.0/0 prefixlen 8 >< 24 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# Remove internal communities before accepting the route
match from 192.0.2.61 set { ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  }

match from 192.0.2.61 set ext-community delete rt 65520:6



allow quick from 192.0.2.61

# ---------------------------------------------
# client AS6_1, outbound

deny quick to 192.0.2.61 community 65520:0



# Blackhole request?
# No blackhole filtering policy given
deny quick to 192.0.2.61 community BLACKHOLE



# NO_EXPORT and NO_ADVERTISE communities

# BGP control communities
allow to 192.0.2.61





# ---------------------------------------------
# client AS6_2, inbound


# Reject inbound routes when 'from 2001:db8:1:1::61 inet' - reject code: 4
match from 2001:db8:1:1::61 inet set community 65520:0
match from 2001:db8:1:1::61 inet set community 65520:4
match quick from 2001:db8:1:1::61 inet set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# NEXT_HOP
match from 2001:db8:1:1::61 set community NO_ADVERTISE
match from 2001:db8:1:1::61 nexthop 2001:db8:1:1::61 set community delete NO_ADVERTISE
# Reject inbound routes when 'from 2001:db8:1:1::61 community NO_ADVERTISE' - reject code: 5
match from 2001:db8:1:1::61 community NO_ADVERTISE set community 65520:0
match from 2001:db8:1:1::61 community NO_ADVERTISE set community 65520:5
match quick from 2001:db8:1:1::61 community NO_ADVERTISE set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: left-most ASN
# Reject inbound routes when 'from 2001:db8:1:1::61 peer-as != 6' - reject code: 6
match from 2001:db8:1:1::61 peer-as != 6 set community 65520:0
match from 2001:db8:1:1::61 peer-as != 6 set community 65520:6
match quick from 2001:db8:1:1::61 peer-as != 6 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# AS_PATH: invalid ASNs
# Reject inbound routes when 'from 2001:db8:1:1::61 AS 0' - reject code: 7
match from 2001:db8:1:1::61 AS 0 set community 65520:0
match from 2001:db8:1:1::61 AS 0 set community 65520:7
match quick from 2001:db8:1:1::61 AS 0 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::61 AS 23456' - reject code: 7
match from 2001:db8:1:1::61 AS 23456 set community 65520:0
match from 2001:db8:1:1::61 AS 23456 set community 65520:7
match quick from 2001:db8:1:1::61 AS 23456 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::61 AS 64496 - 64511' - reject code: 7
match from 2001:db8:1:1::61 AS 64496 - 64511 set community 65520:0
match from 2001:db8:1:1::61 AS 64496 - 64511 set community 65520:7
match quick from 2001:db8:1:1::61 AS 64496 - 64511 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::61 AS 64512 - 65534' - reject code: 7
match from 2001:db8:1:1::61 AS 64512 - 65534 set community 65520:0
match from 2001:db8:1:1::61 AS 64512 - 65534 set community 65520:7
match quick from 2001:db8:1:1::61 AS 64512 - 65534 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::61 AS 65535' - reject code: 7
match from 2001:db8:1:1::61 AS 65535 set community 65520:0
match from 2001:db8:1:1::61 AS 65535 set community 65520:7
match quick from 2001:db8:1:1::61 AS 65535 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


# Reject inbound routes when 'from 2001:db8:1:1::61 AS 65536 - 65551' - reject code: 7
match from 2001:db8:1:1::61 AS 65536 - 65551 set community 65520:0
match from 2001:db8:1:1::61 AS 65536 - 65551 set community 65520:7
match quick from 2001:db8:1:1::61 AS 65536 - 65551 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::61 AS 65552 - 131071' - reject code: 7
match from 2001:db8:1:1::61 AS 65552 - 131071 set community 65520:0
match from 2001:db8:1:1::61 AS 65552 - 131071 set community 65520:7
match quick from 2001:db8:1:1::61 AS 65552 - 131071 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::61 AS 4200000000 - 4294967294' - reject code: 7
match from 2001:db8:1:1::61 AS 4200000000 - 4294967294 set community 65520:0
match from 2001:db8:1:1::61 AS 4200000000 - 4294967294 set community 65520:7
match quick from 2001:db8:1:1::61 AS 4200000000 - 4294967294 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

# Reject inbound routes when 'from 2001:db8:1:1::61 AS 4294967295' - reject code: 7
match from 2001:db8:1:1::61 AS 4294967295 set community 65520:0
match from 2001:db8:1:1::61 AS 4294967295 set community 65520:7
match quick from 2001:db8:1:1::61 AS 4294967295 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# client's white list
# Add the $INTCOMM_ROUTE_OK_WL ext community to routes which
# are validated by a client's white list entry.
# It will be used later during IRRDB validation in
# case the route is not authorized by a client's
# AS-SET.
match from 2001:db8:1:1::61 prefix 2a03:2::/32 prefixlen 32 - 128 source-as 3 set ext-community $INTCOMM_ROUTE_OK_WL	# None
match from 2001:db8:1:1::61 prefix 3.2.0.0/16 prefixlen 16 - 32 source-as 3 set ext-community $INTCOMM_ROUTE_OK_WL	# None

match from 2001:db8:1:1::61 set ext-community $INTCOMM_IRR_REJECT

# AS_PATH: check origin via AS-SET
# IRRDB filters for AS6_2, AS6: asns
# add $INTCOMM_ORIGIN_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 2001:db8:1:1::61 set ext-community $INTCOMM_ORIGIN_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS6 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 2001:db8:1:1::61 ext-community $INTCOMM_ORIGIN_KO set community 999:64515
match from 2001:db8:1:1::61 ext-community $INTCOMM_ORIGIN_KO set large-community 999:0:64515
# adding present_in_as_set community to authorized routes
match from 2001:db8:1:1::61 ext-community $INTCOMM_ORIGIN_OK set community 999:64514
match from 2001:db8:1:1::61 ext-community $INTCOMM_ORIGIN_OK set large-community 999:0:64514


# Prefix: check prefix via AS-SET
# IRRDB filters for AS6_2, AS6: prefixes
# add $INTCOMM_PREFIX_KO to any; it will be removed later if at least one AS-SET authorizes this object
match from 2001:db8:1:1::61 set ext-community $INTCOMM_PREFIX_KO
# verifying if object is authorized by AS-SETs
# AS-SET AS6 referenced but empty.
# adding not_present_in_as_set community to unauthorized routes
match from 2001:db8:1:1::61 ext-community $INTCOMM_PREFIX_KO set community 999:64513
match from 2001:db8:1:1::61 ext-community $INTCOMM_PREFIX_KO set large-community 999:0:64513
# adding present_in_as_set community to authorized routes
match from 2001:db8:1:1::61 ext-community $INTCOMM_PREFIX_OK set community 999:64512
match from 2001:db8:1:1::61 ext-community $INTCOMM_PREFIX_OK set large-community 999:0:64512




# route authorized by a client's white list?
# NO_ADVERTISE here means $INTCOMM_IRR_REJECT
# (OpenBGPD does not allow matching multiple ext comms at once, so a std comm and an ext comm are used)
match from 2001:db8:1:1::61 ext-community $INTCOMM_IRR_REJECT set community NO_ADVERTISE
match from 2001:db8:1:1::61 community NO_ADVERTISE ext-community $INTCOMM_ROUTE_OK_WL set community 999:64517
match from 2001:db8:1:1::61 community NO_ADVERTISE ext-community $INTCOMM_ROUTE_OK_WL set large-community 999:0:64517

match from 2001:db8:1:1::61 community NO_ADVERTISE ext-community $INTCOMM_ROUTE_OK_WL set ext-community delete $INTCOMM_IRR_REJECT
match from 2001:db8:1:1::61 set community delete NO_ADVERTISE

# enforcing: origin ASN
# NO_ADVERTISE here means $INTCOMM_IRR_REJECT
# (OpenBGPD does not allow matching multiple ext comms at once, so a std comm and an ext comm are used)
match from 2001:db8:1:1::61 ext-community $INTCOMM_IRR_REJECT set community NO_ADVERTISE
# Reject inbound routes when 'from 2001:db8:1:1::61 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO' - reject code: 9
match from 2001:db8:1:1::61 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO set community 65520:0
match from 2001:db8:1:1::61 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO set community 65520:9
match quick from 2001:db8:1:1::61 community NO_ADVERTISE ext-community $INTCOMM_ORIGIN_KO set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

match from 2001:db8:1:1::61 set community delete NO_ADVERTISE
# enforcing: prefix
# NO_ADVERTISE here means $INTCOMM_IRR_REJECT
# (OpenBGPD does not allow matching multiple ext comms at once, so a std comm and an ext comm are used)
match from 2001:db8:1:1::61 ext-community $INTCOMM_IRR_REJECT set community NO_ADVERTISE
# Reject inbound routes when 'from 2001:db8:1:1::61 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO' - reject code: 12
match from 2001:db8:1:1::61 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO set community 65520:0
match from 2001:db8:1:1::61 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO set community 65520:12
match quick from 2001:db8:1:1::61 community NO_ADVERTISE ext-community $INTCOMM_PREFIX_KO set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }

match from 2001:db8:1:1::61 set community delete NO_ADVERTISE



# Prefix: length
# Reject inbound routes when 'from 2001:db8:1:1::61 prefix ::/0 prefixlen 12 >< 48' - reject code: 13
match from 2001:db8:1:1::61 prefix ::/0 prefixlen 12 >< 48 set community 65520:0
match from 2001:db8:1:1::61 prefix ::/0 prefixlen 12 >< 48 set community 65520:13
match quick from 2001:db8:1:1::61 prefix ::/0 prefixlen 12 >< 48 set { localpref 1 community delete NO_ADVERTISE ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }



# Remove internal communities before accepting the route
match from 2001:db8:1:1::61 set { ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  }

match from 2001:db8:1:1::61 set ext-community delete rt 65520:6



allow quick from 2001:db8:1:1::61

# ---------------------------------------------
# client AS6_2, outbound

deny quick to 2001:db8:1:1::61 community 65520:0



# Blackhole request?
# No blackhole filtering policy given
deny quick to 2001:db8:1:1::61 community BLACKHOLE



# NO_EXPORT and NO_ADVERTISE communities

# BGP control communities
allow to 2001:db8:1:1::61





# Scrub communities from outbound routes

# Scrub prepending communities


# RFC1997 NO_EXPORT/NO_ADVERTISE received from clients and propagated because of pass-through policy
match to group clients ext-community $INTCOMM_NO_EXPORT set community NO_EXPORT
match to group clients ext-community $INTCOMM_NO_ADVERTISE set community NO_ADVERTISE

# Remove internal communities before announcing the route
match to group clients set { ext-community delete $INTCOMM_PREF_OK_ROA ext-community delete $INTCOMM_ROUTE_OK_WL ext-community delete $INTCOMM_PREF_OK_ARINDB ext-community delete $INTCOMM_ORIGIN_OK ext-community delete $INTCOMM_ORIGIN_KO ext-community delete $INTCOMM_PREFIX_OK ext-community delete $INTCOMM_PREFIX_KO ext-community delete $INTCOMM_IRR_REJECT ext-community delete $INTCOMM_RPKI_UNKNOWN ext-community delete $INTCOMM_RPKI_INVALID ext-community delete $INTCOMM_RPKI_VALID  ext-community delete $INTCOMM_NO_EXPORT ext-community delete $INTCOMM_NO_ADVERTISE  }


